<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Address Sticker Printer</title>
    <link rel="stylesheet" href="/static/styles.css"/>
    
  </head>
  <body>
    <div class="container">
      <section class="hero">
        <div>
          <div style="display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap;">
            <h1>{{ tr('hero_title') }}</h1>
            <div style="display:flex;gap:.5rem;">
              <a class="btn secondary" href="/?lang=en">EN</a>
              <a class="btn secondary" href="/?lang=fr">FR</a>
              <a class="btn secondary" href="/?lang=nl">NL</a>
              <a class="btn secondary" href="/?lang=es">ES</a>
              <a class="btn secondary" href="/?lang=de">DE</a>
              <a class="btn secondary" href="/?lang=it">IT</a>
              <button id="toggle-theme" class="btn secondary" type="button">{{ tr('dark_mode') }}</button>
            </div>
          </div>
          <p>{{ tr('hero_desc') }}</p>
          {% if error %}
          <p style="color:#b91c1c; font-weight:600;">{{ error }}</p>
          {% endif %}
          <div class="badges">
            <span class="badge">CSV upload</span>
            <span class="badge">Avery templates</span>
            <span class="badge">Custom format</span>
            <span class="badge">PDF export</span>
          </div>
        </div>
        <div class="hero-card">
          <img src="/static/images/hero-labels.svg" alt="Address labels preview"/>
        </div>
      </section>

      <h2 class="section-title">{{ tr('how_it_works') }}</h2>
      <div class="grid-3">
        <article class="card"><h3>{{ tr('step1_title') }}</h3><p>{{ tr('step1_desc') }}</p></article>
        <article class="card"><h3>{{ tr('step2_title') }}</h3><p>{{ tr('step2_desc') }}</p></article>
        <article class="card"><h3>{{ tr('step3_title') }}</h3><p>{{ tr('step3_desc') }}</p></article>
      </div>

      <h2 class="section-title">{{ tr('templates_preview') }}</h2>
      <div class="hero-card" style="margin-bottom:1rem;">
        <img src="/static/images/templates-preview.svg" alt="Avery templates preview"/>
      </div>

      <section class="form-panel">
        <h2 style="margin-top:0;">{{ tr('generate_labels') }}</h2>
        <p class="help-text">{{ tr('need_example') }} <a href="/sample.csv">{{ tr('download_sample') }}</a></p>

        <form action="/preview" method="post" enctype="multipart/form-data">
          <input type="hidden" name="lang" value="{{ lang }}"/>
          <div class="form-grid">
            <label>Avery template
              <select name="template" id="template-select" onchange="toggleCustomFields()">
                {% for code in templates %}
                <option value="{{ code }}">{{ code }}</option>
                {% endfor %}
                <option value="CUSTOM">CUSTOM</option>
              </select>
            </label>

            <label>CSV file
              <input type="file" name="csv_file" required accept=".csv,text/csv"/>
            </label>

            <label>Top margin (mm)<input name="top_margin" value="0"/></label>
            <label>Right margin (mm)<input name="right_margin" value="0"/></label>
            <label>Bottom margin (mm)<input name="bottom_margin" value="0"/></label>
            <label>Left margin (mm)<input name="left_margin" value="0"/></label>
          </div>

          <div id="custom-fields" class="form-grid" style="display:none; margin-top:.8rem;">
            <label>Rows <input name="custom_rows" value="7"/></label>
            <label>Columns <input name="custom_cols" value="3"/></label>
            <label>Label width (mm) <input name="custom_label_width_mm" value="63.5"/></label>
            <label>Label height (mm) <input name="custom_label_height_mm" value="38.1"/></label>
            <label>Pitch X (mm) <input name="custom_pitch_x_mm" value="66.7"/></label>
            <label>Pitch Y (mm) <input name="custom_pitch_y_mm" value="38.1"/></label>
            <label>Origin X (mm) <input name="custom_origin_x_mm" value="7.1"/></label>
            <label>Origin Y (mm) <input name="custom_origin_y_mm" value="15.1"/></label>
          </div>

          <div class="actions">
            <button class="btn" type="submit">{{ tr('preview_labels') }}</button>
            <a class="btn secondary" href="/sample.csv">{{ tr('download_sample') }}</a>
          </div>
        </form>
      </section>
    </div>

    <script>
      function toggleCustomFields() {
        const sel = document.getElementById('template-select');
        const cf = document.getElementById('custom-fields');
        cf.style.display = sel.value === 'CUSTOM' ? 'grid' : 'none';
      }
      toggleCustomFields();

      const btn = document.getElementById('toggle-theme');
      const saved = localStorage.getItem('theme');
      if (saved === 'dark') document.body.classList.add('dark');
      btn.addEventListener('click', () => {
        document.body.classList.toggle('dark');
        localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
      });

      {% if ga_measurement_id %}
      function initAnalytics(){
        if(window.__gaLoaded) return;
        window.__gaLoaded = true;
        const s = document.createElement('script');
        s.async = true;
        s.src = 'https://www.googletagmanager.com/gtag/js?id={{ ga_measurement_id }}';
        document.head.appendChild(s);
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);} 
        window.gtag = gtag;
        gtag('js', new Date());
        gtag('config', '{{ ga_measurement_id }}');
      }

      (function(){
        const key='cookie_consent_v1';
        const choice=localStorage.getItem(key);
        const banner=document.getElementById('cookie-banner');
        const accept=document.getElementById('cookie-accept');
        const reject=document.getElementById('cookie-reject');

        if(choice==='accepted'){
          initAnalytics();
        } else if(choice!=='rejected' && banner){
          banner.classList.add('show');
        }

        if(accept){
          accept.addEventListener('click', ()=>{
            localStorage.setItem(key,'accepted');
            banner && banner.classList.remove('show');
            initAnalytics();
          });
        }
        if(reject){
          reject.addEventListener('click', ()=>{
            localStorage.setItem(key,'rejected');
            banner && banner.classList.remove('show');
          });
        }
      })();
      {% endif %}
    </script>

    {% if ga_measurement_id %}
    <div id="cookie-banner" class="cookie-banner" role="dialog" aria-live="polite" aria-label="Cookie consent">
      <div class="cookie-row">
        <div class="cookie-text">
          We use analytics cookies (Google Analytics) to understand traffic and improve this site.
          You can accept or reject analytics cookies.
        </div>
        <div class="cookie-actions">
          <button id="cookie-reject" class="btn secondary" type="button">Reject</button>
          <button id="cookie-accept" class="btn" type="button">Accept</button>
        </div>
      </div>
    </div>
    {% endif %}

  </body>
</html>
